---
title: "Diet Compositions and Obesity"
author: "Ken Ye"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

```{r}
# Load libraries
library(knitr)
library(kableExtra)
library(dplyr)
library(betareg)
```

```{r}
# Load data set
supply_kcal_data <- read.csv("Data/Food_Supply_kcal_Data.csv")
data_dic <- read.csv("Data/Supply_Food_Data_Descriptions.csv")
```

# Introduction

\newpage

# Data

```{r}
kable(data_dic) |>
  column_spec(column = 1, width = "11em")|> 
  column_spec(column = 2, width = "37em")
```

| Categories | Items                    |
|------------|--------------------------|
| Grain      | Cereals - Excluding Beer |
| Vegetable  | Aquatic Products, Other  |
|            | Vegetables               |
|            | Starchy Roots            |
|            | Vegetal Products         |
| Fruit      | Fruits - Excluding Wine  |
| Protein    | Animal Products          |
|            | Eggs                     |
|            | Fish, Seafood            |
|            | Meat                     |
|            | Offals                   |
|            | Oilcrops                 |
|            | Pulses                   |
|            | Treenuts                 |
| Other      | Alcoholic Beverages      |
|            | Animal fats              |
|            | Milk - Excluding Butter  |
|            | Miscellaneous            |
|            | Spices                   |
|            | Stimulants               |
|            | Sugar & Sweeteners       |
|            | Sugar Crops              |
|            | Vegetable Oils           |

```{r}
# Define the mapping of categories to groups
category_mapping <- list(
  Grain = c("Cereals...Excluding.Beer"),
  Vegetable = c("Aquatic.Products..Other", "Vegetables", "Starchy.Roots", "Vegetal.Products"),
  Fruit = c("Fruits...Excluding.Wine"),
  Protein = c("Animal.Products", "Eggs", "Fish..Seafood", "Meat", "Offals", "Oilcrops", "Pulses", "Treenuts"),
  Other = c("Alcoholic.Beverages", "Animal.fats", "Milk...Excluding.Butter", "Miscellaneous", "Spices", "Stimulants", "Sugar.Crops", "Sugar...Sweeteners", "Vegetable.Oils")
)

# Use mutate to create new columns for each group
supply_kcal_data <- supply_kcal_data %>%
  mutate(
    Grain = rowSums(select(supply_kcal_data, category_mapping$Grain)),
    Vegetable = rowSums(select(supply_kcal_data, category_mapping$Vegetable)),
    Fruit = rowSums(select(supply_kcal_data, category_mapping$Fruit)),
    Protein = rowSums(select(supply_kcal_data, category_mapping$Protein)),
    Other = rowSums(select(supply_kcal_data, category_mapping$Other))
  )
```

```{r}
# Create obesity dataframe
selected_columns <- c("Country", "Grain", "Vegetable", "Fruit", "Protein", "Other", "Obesity")
obesity_data <- supply_kcal_data[, selected_columns]
obesity_data <- na.omit(obesity_data)

# Make Obesity a proportion between 0 and 1
obesity_data$Obesity <- obesity_data$Obesity / 100

# Order the data frame based on the 'Obesity' column
obesity_data <- obesity_data[order(obesity_data$Obesity), ]

# Reset row names
rownames(obesity_data) <- NULL

kable(head(obesity_data))
```

```{r}
# Data for Vietnam
vietnam_data <- obesity_data[obesity_data$Country == "Vietnam", c("Grain", "Vegetable", "Fruit", "Protein", "Other")]

# Data for Kiribati
kiribati_data <- obesity_data[obesity_data$Country == "Kiribati", c("Grain", "Vegetable", "Fruit", "Protein", "Other")]

# Data for the United States of America
usa_data <- obesity_data[obesity_data$Country == "United States of America", c("Grain", "Vegetable", "Fruit", "Protein", "Other")]

# Function to create pie chart for a country with percentages
create_pie_chart <- function(country_data, title) {
  # Convert percentages to absolute values
  country_data_abs <- country_data * 0.01 * sum(country_data)
  
  # Calculate percentages for each category
  percentages <- round((country_data_abs / sum(country_data_abs)) * 100, 1)
  
  # Colors for the pie chart
  colors <- c("#E41A1C", "#377EB8", "#4DAF4A", "#FF7F00", "#FDBF6F")
  
  # Create a pie chart
  pie_data <- as.numeric(country_data_abs)
  names(pie_data) <- colnames(country_data_abs)
  
  # Create the pie chart with percentages
  pie(pie_data, labels = paste(names(pie_data), "\n", percentages, "%"), col = colors, main = title)
}

# Set up a 1x3 layout for plots
layout(matrix(1:3, nrow = 1))

# Create pie charts for each country with percentages
create_pie_chart(vietnam_data, "Vietnam (2.1% Obesity Rate)")
create_pie_chart(usa_data, "US (37.3% Obesity Rate)")
create_pie_chart(kiribati_data, "Kiribati (45.6% Obesity Rate)")

# Set up larger outer margins for the overall title
par(oma = c(0, 0, 2, 0))

# Add an overall title
title("Diet Composition (kcal) by Country", outer = TRUE)

# Reset the layout and margins
layout(1)
par(oma = c(0, 0, 0, 0))
```

\newpage

# Methodology

```{r}
# Fit Beta regression model
beta_model <- betareg(Obesity ~ Grain + Vegetable + Fruit + Protein, data = obesity_data)

# Summary of the model
summary(beta_model)
```

\newpage

# Results

\newpage

# Conclusion
