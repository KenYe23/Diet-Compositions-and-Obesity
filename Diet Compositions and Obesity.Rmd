---
title: "Diet Compositions and Obesity"
author: "Ken Ye"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

```{r}
# Load libraries
library(knitr)
library(kableExtra)
library(dplyr)
library(betareg)
library(ggplot2)
library(gridExtra)
```

```{r}
# Load data set
supply_kg_data <- read.csv("Data/Food_Supply_Quantity_kg_Data.csv")
data_dic <- read.csv("Data/Supply_Food_Data_Descriptions.csv")
```

# Introduction

A staggering number of 37.3% of the US population is obese,

The USDA Center for Nutrition Policy and Promotion recommends a very
simple daily diet intake guideline: 30% grains, 40% vegetables, 10%
fruits, and 20% protein. [1] [2]

\newpage

# Data

```{r}
kable(data_dic) |>
  column_spec(column = 1, width = "11em")|> 
  column_spec(column = 2, width = "37em")
```

| Categories | Items                    |
|------------|--------------------------|
| Grains     | Cereals - Excluding Beer |
| Vegetables | Spices                   |
|            | Starchy Roots            |
|            | Vegetables               |
|            | Vegetal Products         |
| Fruits     | Fruits - Excluding Wine  |
| Protein    | Aquatic Products, Other  |
|            | Eggs                     |
|            | Fish, Seafood            |
|            | Meat                     |
|            | Offals                   |
|            | Pulses                   |
| Dairy      | Milk - Excluding Butter  |
| Sugar      | Sugar & Sweeteners       |
| Alcohol    | Alcoholic Beverages      |
| Stimulants |                          |
| Fats       | Animal fats              |
|            | Treenuts                 |
|            | Vegetable Oils           |
| Others     | Animal Products          |
|            | Miscellaneous            |
|            | Oilcrops                 |
|            | Sugar Crops              |

```{r include=FALSE}
# Define the mapping of categories to groups
category_mapping <- list(
  Grains = c("Cereals...Excluding.Beer"),
  Vegetables = c("Spices", "Starchy.Roots", "Vegetables", "Vegetal.Products"),
  Fruits = c("Fruits...Excluding.Wine"),
  Protein = c("Aquatic.Products..Other","Eggs", "Fish..Seafood", "Meat", "Offals", "Pulses"),
  Dairy = c("Milk...Excluding.Butter"),
  Sugar = c("Sugar...Sweeteners"),
  Alcohol = c("Alcoholic.Beverages"),
  Fats = c("Animal.fats", "Treenuts", "Vegetable.Oils"),
  Others = c("Animal.Products", "Miscellaneous", "Oilcrops", "Sugar.Crops")
)

# Mutate the data by combining categories
# Select the variables we are interested in
supply_kg_data <- supply_kg_data |>
  mutate(
    Grains = rowSums(select(supply_kg_data, category_mapping$Grains)),
    Vegetables = rowSums(select(supply_kg_data, category_mapping$Vegetables)),
    Fruits = rowSums(select(supply_kg_data, category_mapping$Fruits)),
    Protein = rowSums(select(supply_kg_data, category_mapping$Protein)),
    Dairy = rowSums(select(supply_kg_data, category_mapping$Dairy)),
    Sugar = rowSums(select(supply_kg_data, category_mapping$Sugar)),
    Alcohol = rowSums(select(supply_kg_data, category_mapping$Alcohol)),
    Fats = rowSums(select(supply_kg_data, category_mapping$Fats)),
    Others = rowSums(select(supply_kg_data, category_mapping$Others))) |>
  select(c("Country", names(category_mapping), "Stimulants", "Obesity"))

# Remove rows with NA values
supply_kg_data <- na.omit(supply_kg_data)

# Transform obesity from percent to proportion between 0-1 for beta regression
supply_kg_data$Obesity <- supply_kg_data$Obesity / 100

# Display the mutated data
kable(head(supply_kg_data)) |>
  kable_styling(font_size = 6)
```

```{r}

```

\newpage

# Methodology

```{r}
# Fit Beta regression model
beta_model <- betareg(Obesity ~ Grains + Vegetables + Fruits + Protein + Dairy + Sugar + Alcohol + Stimulants + Fats, data = supply_kg_data)

# Summary of the model
summary(beta_model)
```

\newpage

# Results

## Compare Japan and US Diet Compositions

```{r}
filtered_data <- supply_kg_data |>
  filter(Country %in% c("Japan", "United States of America"))

kable(filtered_data, row.names = FALSE) |>
  kable_styling(font_size = 6)
```

```{r}
# Data for Japan
japan_data <- supply_kg_data[supply_kg_data$Country == "Japan",]

# Data for the US
us_data <- supply_kg_data[supply_kg_data$Country == "United States of America",]
```

```{r}
# Graph pie charts
pie_charts <- function(data, title_text) {
  chart_data <- data.frame(
    food_groups = names(data[2:10]),
    food_percentage = as.numeric(data[2:10])
  )
  
  ggplot(chart_data, aes(x = "", 
                         y = food_percentage, 
                         fill = food_groups)) +
    geom_bar(stat = "identity", width = 1) +
    theme_classic() +
    theme(plot.title = element_text(hjust = 0.5),
          axis.line = element_blank(),
          axis.text = element_blank(),
          axis.ticks = element_blank(), 
          legend.position = "bottom", 
      legend.direction = "horizontal") +
    labs(fill = "food_group",
         x = NULL,
         y = NULL,
         title = title_text) + 
    coord_polar("y")
}

japan_pie_chart <- pie_charts(japan_data, "Diet Composition (Japan)")
us_pie_chart <- pie_charts(us_data, "Diet Composition (US)")

grid.arrange(japan_pie_chart, us_pie_chart, nrow = 2)
```

```{r}

```

\newpage

# Conclusion

\newpage

# Citations

[1] <https://www.dietaryguidelines.gov/>

[2] <https://www.myplate.gov/>
