---
title: "Diet Compositions and Obesity"
author: "Ken Ye"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

```{r}
# Load libraries
library(knitr)
library(kableExtra)
library(dplyr)
library(betareg)
library(ggplot2)
library(gridExtra)
library(car)
library(glmnet)
```

```{r include = FALSE}
# Load data set
supply <- read.csv("Data/dietary-composition-by-country.csv")
death <- read.csv("Data/share-of-deaths-obesity.csv")
gdp <- read.csv("Data/gdp-per-capita-worldbank.csv")
income.group <- read.csv("Data/world-banks-income-groups.csv")
```

# Introduction

A staggering number of 37.3% of the US population is obese,

The USDA Center for Nutrition Policy and Promotion recommends a very
simple daily diet intake guideline: 30% grains, 40% vegetables, 10%
fruits, and 20% protein. [1] [2]

![MyPlate Guildlines](Data/MyPlate.png)

\newpage

# Data

## Data Cleaning

```{r}
# Filter out 2019 data (newest for both data sets)
# Filter out entities without code (not countries)
supply <- supply |>
  filter(Code != "", Year == 2019) |>
  select(-Code, -Year)

death <- death |>
  filter(Code != "",Year == 2019) |>
  select(-Code, -Year)

gdp <- gdp |>
  filter(Code != "",Year == 2019) |>
  select(-Code, -Year)

income.group <- income.group |>
  filter(Code != "",Year == 2019) |>
  select(-Code, -Year)

# Rename variables
colnames(supply) <- c("Country", "Miscellaneous", "Alcohol", "Animal.fat", "Vegetable.oils", "Oilcrops", "Fish.and.seafood", "Sugar.crops", "Sugar.sweeteners", "Starchy.roots", "Meat.other", "Meat.sheep.and.goat", "Meat.pig", "Meat.poultry", "Meat.beef", "Eggs", "Milk", "Nuts", "Fruit", "Vegetables", "Pulses", "Cereals.other", "Barley", "Maize", "Rice", "Wheat")

colnames(death) <- c("Country", "Death.obesity")

colnames(gdp) <- c("Country", "GDP.per.capita")

colnames(income.group) <- c("Country", "Income.group")
```

```{r}
# Merge data sets
df <- merge(supply, gdp, by = "Country", all = FALSE)
df <- merge(df, income.group, by = "Country", all = FALSE)
df <- merge(df, death, by = "Country", all = FALSE)
```

## Food Groups Re-categorization

| Categories | Items                    |
|------------|--------------------------|
| Grains     | Cereals - Excluding Beer |
| Vegetables | Spices                   |
|            | Starchy Roots            |
|            | Vegetables               |
|            | Pulses\*                 |
| Fruits     | Fruits - Excluding Wine  |
| Protein    | Aquatic Products, Other  |
|            | Eggs                     |
|            | Fish, Seafood            |
|            | Meat                     |
|            | Offals                   |
|            | Pulses\*                 |
|            | Treenuts                 |
| Dairy      | Milk - Excluding Butter  |
| Sugar      | Sugar & Sweeteners       |
| Alcohol    | Alcoholic Beverages      |
| Stimulants | Stimulants               |
| Fats       | Animal fats              |
|            | Vegetable Oils           |
| Others     | Animal Products          |
|            | Miscellaneous            |
|            | Oilcrops                 |
|            | Sugar Crops              |
|            | Vegetal Products         |

\*Pulses: Considered both Vegetables and Protein by USDA.

```{r include = FALSE}
# Define the mapping of categories to groups
category_mapping <- list(
  Grains = c("Cereals...Excluding.Beer"),
  Vegetables = c("Spices", "Starchy.Roots", "Vegetables", "Pulses"),
  Fruits = c("Fruits...Excluding.Wine"),
  Protein = c("Aquatic.Products..Other","Eggs", "Fish..Seafood", "Meat", "Offals", "Pulses", "Treenuts"),
  Dairy = c("Milk...Excluding.Butter"),
  Sugar = c("Sugar...Sweeteners"),
  Alcohol = c("Alcoholic.Beverages"),
  Stimulants = c("Stimulants"),
  Fats = c("Animal.fats", "Vegetable.Oils"),
  Others = c("Animal.Products", "Miscellaneous", "Oilcrops", "Sugar.Crops", "Vegetal.Products")
)

# Mutate the data by combining categories
# Select the variables we are interested in
supply_kg_data <- supply_kg_data |>
  mutate(
    Grains = rowSums(select(supply_kg_data, category_mapping$Grains)),
    Vegetables = rowSums(select(supply_kg_data, category_mapping$Vegetables)),
    Fruits = rowSums(select(supply_kg_data, category_mapping$Fruits)),
    Protein = rowSums(select(supply_kg_data, category_mapping$Protein)),
    Dairy = rowSums(select(supply_kg_data, category_mapping$Dairy)),
    Sugar = rowSums(select(supply_kg_data, category_mapping$Sugar)),
    Alcohol = rowSums(select(supply_kg_data, category_mapping$Alcohol)),
    Stimulants = rowSums(select(supply_kg_data, category_mapping$Stimulants)),
    Fats = rowSums(select(supply_kg_data, category_mapping$Fats)),
    Others = rowSums(select(supply_kg_data, category_mapping$Others))) |>
  select(c("Country", names(category_mapping), "Obesity"))

# Display the mutated data
kable(head(supply_kg_data)) |>
  kable_styling(font_size = 6)
```

\newpage

# Methodology

## Linear Model

```{r}
lm <- lm(Death.obesity ~ . - Country - GDP.per.capita, data = df)
summary(lm)
```

## Beta Regression

```{r}
# Fit Beta regression model
beta_model <- betareg(Obesity ~ Grains + Vegetables + Fruits + Protein + Dairy + Sugar + Alcohol + Stimulants + Fats, data = supply_kg_data)

# Summary of the model
summary(beta_model)
```

```{r}
# Calculate VIF
vif_values <- car::vif(beta_model)

# Display VIF values
kable(vif_values, col.names = c("Variable", "VIF"))
```

\newpage

# Results

## Compare Japan and US Diet Compositions

```{r}
filtered_data <- supply_kg_data |>
  filter(Country %in% c("Japan", "United States of America"))

kable(filtered_data, row.names = FALSE) |>
  kable_styling(font_size = 6)
```

```{r}
# Data for Japan
japan_data <- supply_kg_data[supply_kg_data$Country == "Japan",]

# Data for the US
us_data <- supply_kg_data[supply_kg_data$Country == "United States of America",]
```

```{r}
# Graph pie charts
pie_charts <- function(data, title_text) {
  chart_data <- data.frame(
    food_groups = names(data[2:10]),
    food_percentage = as.numeric(data[2:10])
  )
  
  ggplot(chart_data, aes(x = "", 
                         y = food_percentage, 
                         fill = food_groups)) +
    geom_bar(stat = "identity", width = 1) +
    theme_classic() +
    theme(plot.title = element_text(hjust = 0.5),
          axis.line = element_blank(),
          axis.text = element_blank(),
          axis.ticks = element_blank(), 
          legend.position = "bottom", 
      legend.direction = "horizontal") +
    labs(fill = "food_group",
         x = NULL,
         y = NULL,
         title = title_text) + 
    coord_polar("y")
}

japan_pie_chart <- pie_charts(japan_data, "Diet Composition (Japan)")
us_pie_chart <- pie_charts(us_data, "Diet Composition (US)")

grid.arrange(japan_pie_chart, us_pie_chart, nrow = 2)
```

## Predict Obesity Rate with USDA Guidelines

```{r}
# Create a data frame with USDA guidelines
usda_guidelines <- data.frame(
  Grains = 30,
  Vegetables = 40,
  Fruits = 10,
  Protein = 20,
  Dairy = 0, 
  Sugar = 0, 
  Alcohol = 0, 
  Stimulants = 0, 
  Fats = 0
)
```

```{r}
# Make predictions based on USDA guidelines
predicted_obesity <- predict(beta_model, newdata = usda_guidelines, type = "response")

cat("Predicted Obesity Rate with USDA Guidelines:", predicted_obesity, "\n")
```

\newpage

# Conclusion

![MyPlate Plan](Data/MyPlate%20Plan.jpg)

## Limitations

1)  supply, not consumption

\newpage

# Citations

[1] <https://www.dietaryguidelines.gov/>

[2] <https://www.myplate.gov/>
